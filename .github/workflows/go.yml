name: Build
on: [push]
jobs:
  build:
    name: workerpoolxt
    runs-on: ubuntu-latest
    steps:
    - name: Go ^1.13
      uses: actions/setup-go@v2.1.3
      with:
        go-version: ^1.13
      id: "go"
    - name: Test
      run: |
        set -e
        echo "" > coverage.txt
        for d in $(go list ./... | grep -v vendor); do
            go test -race -coverprofile=profile.out -covermode=atomic $d
            if [ -f profile.out ]; then
                cat profile.out >> coverage.out
                rm profile.out
            fi
        done
    - name: Coveralls
      run: |
        go get github.com/mattn/goveralls 
        go get -u github.com/rakyll/gotest 
        $GOPATH/bin/goveralls -coverprofile=coverage.out -service=github -repotoken=$COVERALLS_TOKEN
